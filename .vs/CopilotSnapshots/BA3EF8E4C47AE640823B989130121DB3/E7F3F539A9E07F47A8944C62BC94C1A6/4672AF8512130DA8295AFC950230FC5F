using System;
using System.Drawing;
using System.Windows.Forms;
using Central_de_Software.Utilities;

public class UserControlSoftwareFunction : UserControl
{
    private string nomeSoftware;
    private string iconeSoftware;
    private PictureBox pictureBox;
    private Label labelTitulo;
    private Label labelDescricao;
    private Button btnInstalar;

    public UserControlSoftwareFunction(string nome, string icone)
    {
        nomeSoftware = nome;
        iconeSoftware = icone;
        InitializeComponent();
    }

    private void InitializeComponent()
    {
        this.Dock = DockStyle.Fill;
        this.BackColor = Color.White;
        var corAzul = ColorTranslator.FromHtml("#1A377B");
        var corLaranja = ColorTranslator.FromHtml("#F15A22");

        pictureBox = new PictureBox
        {
            Width = 80,
            Height = 80,
            Top = 60,
            Left = 60,
            SizeMode = PictureBoxSizeMode.Zoom,
            Anchor = AnchorStyles.Top | AnchorStyles.Left
        };
        if (!string.IsNullOrEmpty(iconeSoftware))
            pictureBox.Image = ResourceImages.GetImage(iconeSoftware);

        labelTitulo = new Label
        {
            Text = nomeSoftware ?? "Selecione um software ao lado para instalar.",
            Font = new Font("Segoe UI", 20, FontStyle.Bold),
            AutoSize = true,
            Top = 60,
            Left = 160,
            ForeColor = corAzul,
            Anchor = AnchorStyles.Top | AnchorStyles.Left
        };

        labelDescricao = new Label
        {
            Text = nomeSoftware == null ?
                "Escolha um software no menu à esquerda para ver detalhes e instalar." :
                $"Clique no botão abaixo para instalar o {nomeSoftware}.",
            Font = new Font("Segoe UI", 12),
            AutoSize = true,
            Top = 120,
            Left = 60,
            ForeColor = corLaranja,
            Anchor = AnchorStyles.Top | AnchorStyles.Left
        };

        btnInstalar = new Button
        {
            Text = nomeSoftware == null ? "" : $"Instalar {nomeSoftware}",
            Width = 220,
            Height = 44,
            Top = 180,
            Left = 60,
            Font = new Font("Segoe UI", 12, FontStyle.Bold),
            BackColor = corAzul,
            ForeColor = Color.White,
            FlatStyle = FlatStyle.Flat,
            Visible = nomeSoftware != null
        };
        btnInstalar.FlatAppearance.BorderSize = 0;
        btnInstalar.FlatAppearance.MouseOverBackColor = corLaranja;
        btnInstalar.Click += (s, e) => InstalarSoftware();

        this.Controls.Add(pictureBox);
        this.Controls.Add(labelTitulo);
        this.Controls.Add(labelDescricao);
        this.Controls.Add(btnInstalar);
    }

    private async void InstalarSoftware()
    {
        if (string.IsNullOrEmpty(nomeSoftware)) return;
        string resourceName = null, tempName = null, args = "";
        switch (nomeSoftware)
        {
            case "AnyDesk":
                resourceName = "Central_de_Software.Resources.anydesk.exe";
                tempName = "anydesk_installer.exe";
                break;
            case "Google Chrome":
                resourceName = "Central_de_Software.Resources.chrome_installer.exe";
                tempName = "chrome_installer.exe";
                break;
            case "WinRAR":
                resourceName = "Central_de_Software.Resources.winrar.exe";
                tempName = "winrar_installer.exe";
                break;
            case "WhatsApp Desktop":
                resourceName = "Central_de_Software.Resources.whatsapp.exe";
                tempName = "whatsapp_installer.exe";
                break;
            case "Adobe Acrobat Reader":
                resourceName = "Central_de_Software.Resources.adobe.exe";
                tempName = "adobe_installer.exe";
                break;
            case "Revo Uninstaller":
                resourceName = "Central_de_Software.Resources.revo.exe";
                tempName = "revo_installer.exe";
                break;
            case "Office 365":
                resourceName = "Central_de_Software.Resources.office.exe";
                tempName = "office_installer.exe";
                break;
        }
        if (resourceName != null && tempName != null)
        {
            try
            {
                await SoftwareInstaller.InstallFromEmbeddedAsync(resourceName, tempName, args, true);
                MessageBox.Show($"{nomeSoftware} instalado com sucesso!", "Instalação", MessageBoxButtons.OK, MessageBoxIcon.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erro ao instalar {nomeSoftware}: {ex.Message}", "Erro", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }
    }
}
