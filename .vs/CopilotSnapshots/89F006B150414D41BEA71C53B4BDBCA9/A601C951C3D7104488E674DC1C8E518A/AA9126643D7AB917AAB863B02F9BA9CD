using System;
using System.Drawing;
using System.Windows.Forms;
using Central_de_Software.Utilities;
using Central_de_Software;

public class FormMain : Form
{
    private Panel panelMenuSuperior;
    private Button btnMenuInicio;
    private Button btnMenuSoftwares;
    private Button btnMenuTools;
    private Button btnMenuFiscal;
    private Panel panelLateral;
    private Panel panelCentral;

    // UserControls para cada tema
    private UserControlTools userControlTools = new UserControlTools { ModoTecnico = false };
    private UserControlFiscal userControlFiscal = new UserControlFiscal();
    private UserControlFiscalXmlEditor userControlFiscalXmlEditor = new UserControlFiscalXmlEditor();
    private UserControlHome userControlHome = new UserControlHome();
    private UserControlSoftware userControlSoftware = new UserControlSoftware();
    private UserControlDiagnostics userControlDiagnostics = new UserControlDiagnostics();
    private UserControlDiagnosticsTech userControlDiagnosticsTech;

    // Cores do tema
    private Color corAzul = ColorTranslator.FromHtml("#1A377B");
    private Color corLaranja = ColorTranslator.FromHtml("#F15A22");
    private Color corBranco = Color.White;
    private Color corCinza = Color.WhiteSmoke;

    private const string senhaTecnico = "1212";

    public FormMain()
    {
        InitializeComponent();
        this.KeyPreview = true;
        this.KeyDown += FormMain_KeyDown;
        userControlDiagnosticsTech = new UserControlDiagnosticsTech();
        userControlDiagnosticsTech.VoltarClicked += UserControlDiagnosticsTech_VoltarClicked;
    }

    private void UserControlDiagnosticsTech_VoltarClicked(object sender, EventArgs e)
    {
        ShowLateralMenu("inicio");
        btnMenuInicio.BackColor = corAzul;
        btnMenuInicio.ForeColor = corBranco;
    }

    private void FormMain_KeyDown(object sender, KeyEventArgs e)
    {
        if (e.Control && e.KeyCode == Keys.T)
        {
            e.SuppressKeyPress = true;
            ShowTechMode();
        }
    }

    private void ShowTechMode()
    {
        using (var form = new Form
        {
            Width = 300,
            Height = 150,
            FormBorderStyle = FormBorderStyle.FixedDialog,
            StartPosition = FormStartPosition.CenterParent,
            Text = "Modo Técnico",
            BackColor = Color.FromArgb(30, 30, 30)
        })
        {
            var txtPassword = new TextBox
            {
                Left = 20,
                Top = 50,
                Width = 240,
                UseSystemPasswordChar = true,
                BackColor = Color.FromArgb(45, 45, 45),
                ForeColor = Color.White
            };

            var btnOk = new Button
            {
                Text = "OK",
                Left = 100,
                Top = 80,
                Width = 80,
                DialogResult = DialogResult.OK,
                BackColor = Color.FromArgb(60, 60, 60),
                ForeColor = Color.White,
                FlatStyle = FlatStyle.Flat
            };
            btnOk.FlatAppearance.BorderSize = 0;

            var lblPassword = new Label
            {
                Text = "Digite a senha para acessar o modo técnico:",
                Left = 20,
                Top = 20,
                AutoSize = true,
                ForeColor = Color.White
            };

            form.Controls.AddRange(new Control[] { txtPassword, btnOk, lblPassword });
            form.AcceptButton = btnOk;
            txtPassword.Focus();

            if (form.ShowDialog() == DialogResult.OK)
            {
                if (txtPassword.Text == senhaTecnico)
                {
                    // Abre a tela técnica e fecha a principal
                    this.Hide();
                    var tecnico = new FormTecnico();
                    tecnico.ShowDialog();
                    this.Show();
                }
                else
                {
                    MessageBox.Show("Senha incorreta!", "Erro", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }
        }
    }

    private void InitializeComponent()
    {
        this.Text = "Central de Software";
        this.Width = 950;
        this.Height = 700;
        this.FormBorderStyle = FormBorderStyle.FixedDialog;
        this.MaximizeBox = false;
        this.MinimizeBox = true;
        this.StartPosition = FormStartPosition.CenterScreen;
        this.MaximumSize = new Size(950, 700);
        this.MinimumSize = new Size(950, 700);

        // Menu superior
        panelMenuSuperior = new Panel { Height = 80, Dock = DockStyle.Top, BackColor = corCinza };
        btnMenuInicio = CriarBotaoMenu("  Início", ResourceImages.GetImage("home.png"), 20, 10, OnMenuClick, "inicio");
        btnMenuSoftwares = CriarBotaoMenu("  Softwares", ResourceImages.GetImage("software.png"), 220, 10, OnMenuClick, "softwares");
        btnMenuTools = CriarBotaoMenu("  Tools", ResourceImages.GetImage("tools.png"), 420, 10, OnMenuClick, "tools");
        btnMenuFiscal = CriarBotaoMenu("  Fiscal", ResourceImages.GetImage("fiscal.png"), 620, 10, OnMenuClick, "fiscal");

        panelMenuSuperior.Controls.AddRange(new Control[] {
            btnMenuInicio,
            btnMenuSoftwares,
            btnMenuTools,
            btnMenuFiscal
        });

        // Painel lateral e central
        panelLateral = new Panel { Width = 220, Dock = DockStyle.Left, BackColor = Color.FromArgb(240, 240, 240) };
        panelCentral = new Panel { Dock = DockStyle.Fill, BackColor = Color.White };

        this.Controls.Add(panelCentral);
        this.Controls.Add(panelLateral);
        this.Controls.Add(panelMenuSuperior);

        // Exibe mensagem de boas-vindas ao abrir
        ShowLateralMenu("inicio");
        btnMenuInicio.BackColor = corAzul;
        btnMenuInicio.ForeColor = corBranco;
    }

    private Button CriarBotaoMenu(string texto, Image icone, int left, int top, EventHandler click, string tag)
    {
        var btn = new Button
        {
            Text = texto,
            TextAlign = ContentAlignment.MiddleRight,
            ImageAlign = ContentAlignment.MiddleLeft,
            Width = 180,
            Height = 60,
            FlatStyle = FlatStyle.Flat,
            Font = new Font("Segoe UI", 11, FontStyle.Bold),
            Image = icone,
            Location = new Point(left, top),
            Anchor = AnchorStyles.Top | AnchorStyles.Left,
            BackColor = corBranco,
            ForeColor = corAzul,
            Tag = tag,
            TabStop = false
        };
        btn.FlatAppearance.BorderSize = 0;
        btn.FlatAppearance.MouseOverBackColor = corLaranja;
        btn.FlatAppearance.MouseDownBackColor = corAzul;
        btn.Click += click;
        return btn;
    }

    private void OnMenuClick(object sender, EventArgs e)
    {
        var btn = sender as Button;
        string tema = btn.Tag.ToString();
        // Resetar cores
        foreach (Control c in panelMenuSuperior.Controls)
        {
            if (c is Button b)
            {
                b.BackColor = corBranco;
                b.ForeColor = corAzul;
            }
        }
        // Selecionado
        btn.BackColor = corAzul;
        btn.ForeColor = corBranco;
        ShowLateralMenu(tema);
    }

    private void ShowLateralMenu(string tema)
    {
        panelLateral.Controls.Clear();
        panelCentral.Controls.Clear();
        
        switch (tema)
        {
            case "inicio":
                ShowCentralContent(userControlHome);
                break;

            case "softwares":
                // Criar botões para cada software
                int top = 30;
                foreach (var sw in new[] {
                    ("AnyDesk", "anydesk.png"),
                    ("Google Chrome", "chrome.png"),
                    ("WinRAR", "winrar.png"),
                    ("WhatsApp Desktop", "whatsapp.png"),
                    ("Adobe Acrobat Reader", "adobe.png"),
                    ("Revo Uninstaller", "revo.png"),
                    ("Office 365", "office.png")
                })
                {
                    var btn = new Button
                    {
                        Text = "  " + sw.Item1,
                        Width = 200,
                        Height = 50,
                        Top = top,
                        Left = 10,
                        Font = new Font("Segoe UI", 10F),
                        Image = ResourceImages.GetImage(sw.Item2),
                        ImageAlign = ContentAlignment.MiddleLeft,
                        TextAlign = ContentAlignment.MiddleRight,
                        FlatStyle = FlatStyle.Flat,
                        BackColor = corBranco,
                        ForeColor = corAzul,
                        Anchor = AnchorStyles.Top | AnchorStyles.Left | AnchorStyles.Right,
                        Tag = sw.Item1
                    };
                    btn.FlatAppearance.BorderSize = 0;
                    btn.FlatAppearance.MouseOverBackColor = corLaranja;
                    btn.FlatAppearance.MouseDownBackColor = corAzul;
                    btn.Click += (s, e) => ShowCentralContent(new UserControlSoftwareFunction(sw.Item1, sw.Item2));
                    panelLateral.Controls.Add(btn);
                    top += 60;
                }
                ShowCentralContent(new UserControlSoftwareFunction(null, null));
                break;

            case "tools":
                var btnTools = new Button
                {
                    Text = "  Otimização do Windows",
                    Width = 200,
                    Height = 50,
                    Top = 30,
                    Left = 10,
                    Font = new Font("Segoe UI", 10F),
                    Image = ResourceImages.GetImage("tools.png"),
                    ImageAlign = ContentAlignment.MiddleLeft,
                    TextAlign = ContentAlignment.MiddleRight,
                    FlatStyle = FlatStyle.Flat,
                    BackColor = corBranco,
                    ForeColor = corAzul,
                    Anchor = AnchorStyles.Top | AnchorStyles.Left | AnchorStyles.Right
                };
                btnTools.FlatAppearance.BorderSize = 0;
                btnTools.FlatAppearance.MouseOverBackColor = corLaranja;
                btnTools.FlatAppearance.MouseDownBackColor = corAzul;
                btnTools.Click += (s, e) => ShowCentralContent(userControlTools);
                panelLateral.Controls.Add(btnTools);
                userControlTools.ModoTecnico = false;
                userControlTools.Controls.Clear();
                userControlTools = new UserControlTools { ModoTecnico = false };
                ShowCentralContent(userControlTools);
                break;

            case "fiscal":
                var btnFiscal = new Button
                {
                    Text = "  Editor de XML da NFe",
                    Width = 200,
                    Height = 50,
                    Top = 30,
                    Left = 10,
                    Font = new Font("Segoe UI", 10F),
                    Image = ResourceImages.GetImage("xml.png"),
                    ImageAlign = ContentAlignment.MiddleLeft,
                    TextAlign = ContentAlignment.MiddleRight,
                    FlatStyle = FlatStyle.Flat,
                    BackColor = corBranco,
                    ForeColor = corAzul,
                    Anchor = AnchorStyles.Top | AnchorStyles.Left | AnchorStyles.Right
                };
                btnFiscal.FlatAppearance.BorderSize = 0;
                btnFiscal.FlatAppearance.MouseOverBackColor = corLaranja;
                btnFiscal.FlatAppearance.MouseDownBackColor = corAzul;
                btnFiscal.Click += (s, e) => ShowCentralContent(userControlFiscalXmlEditor);
                panelLateral.Controls.Add(btnFiscal);
                ShowCentralContent(userControlFiscalXmlEditor);
                break;
        }
    }

    private void ShowCentralContent(UserControl control)
    {
        panelCentral.Controls.Clear();
        if (control != null)
        {
            control.Dock = DockStyle.Fill;
            panelCentral.Controls.Add(control);
        }
    }
}
