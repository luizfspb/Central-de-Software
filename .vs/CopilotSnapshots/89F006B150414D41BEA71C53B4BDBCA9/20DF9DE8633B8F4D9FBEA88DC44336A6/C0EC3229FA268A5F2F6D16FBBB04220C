using System;
using System.Drawing;
using System.Windows.Forms;
using System.Threading.Tasks;

public class UserControl3uTools : UserControl
{
    public UserControl3uTools()
    {
        InitializeComponent();
    }

    private void InitializeComponent()
    {
        this.Dock = DockStyle.Fill;
        this.BackColor = Color.White;

        var btnAbrir = new Button
        {
            Text = "Abrir 3uTools",
            Width = 220,
            Height = 60,
            Font = new Font("Segoe UI", 12, FontStyle.Bold),
            BackColor = Color.White,
            ForeColor = ColorTranslator.FromHtml("#1A377B"),
            FlatStyle = FlatStyle.Flat,
            Location = new Point(40, 40)
        };
        btnAbrir.FlatAppearance.BorderSize = 0;
        btnAbrir.FlatAppearance.MouseOverBackColor = ColorTranslator.FromHtml("#F15A22");
        btnAbrir.FlatAppearance.MouseDownBackColor = ColorTranslator.FromHtml("#1A377B");
        btnAbrir.Click += async (s, e) => await Abrir3uTools();
        this.Controls.Add(btnAbrir);
    }

    private async Task Abrir3uTools()
    {
        using (var form = new Form
        {
            Width = 300,
            Height = 150,
            FormBorderStyle = FormBorderStyle.FixedDialog,
            StartPosition = FormStartPosition.CenterParent,
            Text = "Senha 3uTools",
            BackColor = Color.White
        })
        {
            var txtPassword = new TextBox
            {
                Left = 20,
                Top = 50,
                Width = 240,
                UseSystemPasswordChar = true
            };
            var btnOk = new Button
            {
                Text = "OK",
                Left = 100,
                Top = 80,
                Width = 80,
                DialogResult = DialogResult.OK
            };
            var lblPassword = new Label
            {
                Text = "Digite a senha para abrir o 3uTools:",
                Left = 20,
                Top = 20,
                AutoSize = true
            };
            form.Controls.AddRange(new Control[] { txtPassword, btnOk, lblPassword });
            form.AcceptButton = btnOk;
            txtPassword.Focus();
            if (form.ShowDialog() == DialogResult.OK)
            {
                if (txtPassword.Text == "helio")
                {
                    try
                    {
                        var psi = new System.Diagnostics.ProcessStartInfo
                        {
                            FileName = "C:\\Program Files\\3uToolsV3\\3uTooIs.exe",
                            UseShellExecute = false,
                            Verb = "runas",
                            UserName = "administrador",
                            Password = ConvertToSecureString("vcardu@2509"),
                            Domain = Environment.MachineName
                        };
                        System.Diagnostics.Process.Start(psi);
                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show($"Erro ao abrir 3uTools: {ex.Message}", "Erro", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    }
                }
                else
                {
                    MessageBox.Show("Senha incorreta!", "Erro", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }
        }
    }

    private System.Security.SecureString ConvertToSecureString(string senha)
    {
        var secure = new System.Security.SecureString();
        foreach (char c in senha)
            secure.AppendChar(c);
        secure.MakeReadOnly();
        return secure;
    }
}
